<head>
    <script src="https://rawgit.com/pixijs/pixi.js/dev/bin/pixi.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/styles/ascetic.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.5.0/highlight.min.js"></script>

    <script src="https://rawgit.com/davidfig/update/master/update.js"></script>
    <script src="https://rawgit.com/davidfig/renderer/master/renderer.js"></script>
    <script src="https://rawgit.com/davidfig/angle/master/angle.js"></script>
    <script src="https://rawgit.com/davidfig/animate/master/animate.js"></script>
    <script src="https://rawgit.com/davidfig/debug/master/debug.js"></script>
    <script src="https://rawgit.com/davidfig/animate/master/easing.js"></script>

    <!--for local testing-->
    <!--<script src="../debug/debug.js"></script>
    <script src="../update/update.js"></script>
    <script src="../renderer/renderer.js"></script>
    <script src="../angle/angle.js"></script>
    <script src="../animate/animate.js"></script>
    <script src="../animate/easing.js"></script>
    <script src="../animate/animate.js"></script>-->

    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .title {
            margin-top: 1%;
            margin-left: 15%;
            font-size: 200%;
        }
        #code {
            left: 15%;
            position: absolute;
            word-wrap: break-word;
            z-index: -1;
        }
    </style>
</head>
<body>
    <div class="title">Example for <a href="https://github.com/davidfig/animate/">github.com/davidfig/animate/</a></div>
    <pre><code class="javascript" id="code"></code></pre>
    <script id="sample">

        // initialize Debug and Update -- this is only needed for the debug panels on the bottom right
        Debug.init();
        Update.init({debug: true});

        // set up pixi and shapes
        var renderer, red, green, blue, shaker, theDots = [], theDotsScale, pacman;
        pixi();

        // red triangle fades, moves, and scales; repeats and reverses forever
        // NOTE: the "renderer: renderer" option marks the renderer as dirty each update to ensure the page is redrawn
        Animate.to(red, {alpha: 0.1, x: 500, y: 500, scale: {x: 5, y: 5}}, 1000,
            {repeat: true, reverse: true, renderer: renderer}, Easing.easeInOutSine);

        // green triangle moves, rotates, and fades when done
        Animate.to(green, {x: 50, y: 400, rotation: 2 * Math.PI}, 2500,
            {reverse: true, onDone: function (object) { Animate.to(object, {alpha: 0}, 2000); }}, Easing.easeInSine);

        // blue triangle spins forever
        Animate.to(blue, {rotation: -2 * Math.PI}, 1000, {continue: true});

        // circle changes from blue to red and reverse and repeats
        Animate.tint(shaker, 0xff0000, 2000, {repeat: true, reverse: true});

        // circle also shakes forever, it starts after 1 second
        Animate.shake(shaker, 5, 0, {repeat: true, wait: 1000});

        // animate a group that is not a container
        Animate.to(theDots, {alpha: 0.01, scale: {x: 3, y: 3}}, 2000, {renderer: renderer, repeat: true, reverse: true}, Easing.easeInOutSine);

        // pacman mouth animation
        Animate.to(pacman, {angle: 0.01}, 250, {onEach: function()
            {
                pacman.clear()
                    .moveTo(Math.cos(pacman.angle) * pacman.radius / 2, Math.sin(pacman.angle) * pacman.radius / 2)
                    .lineStyle(pacman.radius, 0xffff00)
                    .arc(0, 0, pacman.radius / 2, Math.PI * pacman.angle, Math.PI * -pacman.angle, false);
            }, repeat: true, reverse: true});

        // pacman walking animation
        function nextTarget()
        {
            var target = {x: Math.random() * window.innerWidth, y: Math.random() * window.innerHeight};

            // rotate pacman around the short way to the target
            Animate.remove(rotate);
            var angle = angleTwoPoints(pacman, target);
            angle = shortestAngle(pacman.rotation, angle)
            var rotate = Animate.to(pacman, {rotation: angle}, 500, null, Easing.easeInOutSine);
            return target;
        }

        var target = nextTarget(), rotate;
        var options = Animate.target(pacman, target, 0.15, {keepAlive: true, onDone:
            function()
            {
                options.target = nextTarget();
            }
        });

        // triangle facing pacman
        var facing = pointer(100, 0x00ffff);
        facing.position.set(600, 400);
        Animate.face(facing, pacman, 0.00075, {keepAlive: true});

        Update.update();

        function pixi()
        {
            renderer = new Renderer({transparent: true, styles: {resize: true, background: green, pointerEvents: "none"}});
            red = triangle(100, 0xff0000);
            red.position.set(50, 50);
            green = triangle(50, 0x00ff00);
            green.position.set(300,300);
            blue = triangle(50, 0x0000ff);
            blue.position.set(500,100);
            shaker = PIXI.Sprite.fromImage('circle.png');
            renderer.addChild(shaker);
            shaker.tint = 0x0000ff;
            shaker.position.set(200, 200);
            dots(800, 250, 150, 10);
            pacmanCreate(100, 100, 100, 100);
        }

        function triangle(size, color)
        {
            var half = size / 2;
            var g = new PIXI.Graphics();
            renderer.addChild(g);
            g.beginFill(color);
            g.moveTo(0, -half);
            g.lineTo(-half, half);
            g.lineTo(half, half);
            g.closePath();
            g.endFill();
            return g;
        }

        function pointer(size, color)
        {
            var g = new PIXI.Graphics();
            renderer.addChild(g);
            g.beginFill(color);
            g.drawCircle(0, 0, size / 2);
            g.endFill();
            g.lineStyle(10, color);
            g.moveTo(0, 0);
            g.lineTo(-size, 0);
            g.closePath();
            return g;
        }

        function dots(x, y, distance, size)
        {
            for (var i = 0; i < 100; i++)
            {
                sprite = PIXI.Sprite.fromImage('circle.png');
                sprite.anchor.set(0.5);
                sprite.alpha = 0.5;
                sprite.tint = 0xff00ff;
                renderer.addChild(sprite);
                theDots.push(sprite);
                var angle = Math.random() * 2 * Math.PI;
                var dist = Math.random() * distance;
                sprite.x = x + Math.cos(angle) * dist;
                sprite.y = y + Math.sin(angle) * dist;
            }
        }

        function pacmanCreate(x, y, size)
        {
            pacman = renderer.addChild(new PIXI.Graphics());
            pacman.position.set(x, y);
            pacman.radius = size / 2;
            pacman.angle = 0.3;
        }

    </script>
    <script>
        window.onload = function()
        {
            var code = document.getElementById('code');
            var script = document.getElementById('sample');
            code.innerHTML = script.innerHTML;
            hljs.highlightBlock(code);
        };
    </script>
</body>